@using Microsoft.AspNetCore.Http;
@using Newtonsoft.Json;
@using BE;
@using Microsoft.AspNetCore.Identity;
@inject IHttpContextAccessor httpcontextaccessor
@inject UserManager<UserApp> usermanager


    <div class="container">
        @if (ViewBag.SuccessPayment != null)
        {
            <div class="" style="font-size:50px;margin-right:10px;">
                @ViewBag.SuccessPayment
            </div>
        }
        <div class="row">
            @{
                var user = await usermanager.FindByNameAsync(User.Identity.Name);
            }
            <div class="col-12 col-lg-3">
                <div class="card bg-info my-5 p-5">
                    <img src="images/user.png" class="img-fluid rounded-circle d-block mx-auto" width="120px" height="120px" alt="user-image">
                    <h5 class="text-white text-center mt-3">کاربر:@user.FirstName @user.LastName</h5>
                </div>
                <div class="text-right">
                    <div class="list-group p-0 mb-5 profile">
                        <a href="#vaziyat" class="list-group-item list-group-item-action font-14" data-toggle="list"> <i class="fa fa-cog align-middle ml-2"></i>مرور وضعیت </a>
                        <a href="#dore-signup" class="list-group-item list-group-item-action" data-toggle="list"> <i class="fa fa-server  align-middle ml-2"></i>دوره هایی که ثبت نام کرده اید </a>
                        <a href="#shopping-cart" class="@ViewBag.showBasket list-group-item list-group-item-action " data-toggle="list"><i class="fa fa-shopping-cart align-middle ml-2"></i>سبد خرید </a>
                        <a href="#ticket" class="list-group-item list-group-item-action " data-toggle="list"><i class="fa fa-tags align-middle ml-2"></i>تیکت ها </a>
                        <a href="#user-change" class="list-group-item list-group-item-action" data-toggle="list"><i class="fa fa-address-card align-middle ml-2"></i> تغییر مشخصات  </a>
                        <a href="index.html" class="list-group-item list-group-item-action"> <i class=" fa fa-window-close align-middle ml-2"></i> خروج</a>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-9">

                <div class="tab-content">

                    <div class="tab-pane fade show" id="vaziyat">
                        <!----- Start vaziyat ----->
                        <div class="card my-5 pb-4 text-right">
                            <div class="card-header text-center">
                                <h6 class="mt-2"> مرور وضعیت </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">

                                    <div class="col-12 col-md-6">
                                        <div class="card mb-2">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <img src="images/university-campus.png" class="img-fluid d-inline-block p-2 rounded bg-warning" alt="courses">
                                                <div class="d-inline-block text-center">
                                                    <p class="mb-0"> 12 دوره  </p>
                                                    <small> در سایت وجود دارد </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-6">
                                        <div class="card mb-2">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <img src="images/a.png" class="img-fluid d-inline-block p-2 rounded bg-warning" alt="courses">
                                                <div class="d-inline-block text-center">
                                                    <p class="mb-0"> 3 دوره  </p>
                                                    <small> ثبت نام کرده اید </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-6">
                                        <div class="card mb-2">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <img src="images/shopping-cart.png" class="img-fluid d-inline-block p-2 rounded bg-warning" alt="courses">
                                                <div class="d-inline-block text-center">
                                                    <p class="mb-0"> 0 دوره  </p>
                                                    <small>  در انتظار پرداخت  </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-6">
                                        <div class="card mb-2">
                                            <div class="card-body d-flex justify-content-between align-items-center">
                                                <img src="images/wallet-filled-money-tool.png" class="img-fluid d-inline-block p-2 rounded bg-warning" alt="courses">
                                                <div class="d-inline-block text-center">
                                                    <p class="mb-0">  0 تومان   </p>
                                                    <small>  موجودی قابل تسویه شما  </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="card mt-3">
                                            <div class="card-body bg-light">
                                                <p class="mb-2"> <i class="fa fa-bell align-middle"></i>  جدیدترین اعلان ها  </p>
                                                <small> در تاریخ 1398/01/25 </small>
                                                <div class="alert alert-info mt-3">
                                                    <p class="font-13 text-center mt-3">کد تخفیف 30 % : Takhfif</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div><!----- End vaziyat ----->


                    <div class="tab-pane fade show text-center" id="dore-signup">
                        <!----- Start dore signup ----->
                        <div class="card my-5 pb-4 text-center">
                            <div class="card-header">
                                <h6 class="mt-2 font-14"> دوره هایی که ثبت نام کرده اید  </h6>
                            </div>
                            <div class="card-body">

                                <div class="card mb-3 pb-4 shadow-sm">
                                    <div class="card-body d-md-flex">
                                        <img src="images/html-2.png" class="img-fluid float-lg-right mb-2" alt="html" width="250px" height="300px">
                                        <div class="d-inline-block pr-3 text-justify my-course">
                                            <a href="Category.html" class="mb-3 d-block text-center text-dark">آموزش HTML</a>
                                            <small>
                                                بخش اول متخصص طراحی سایت :
                                                زبان نشانه گذاری HTML به عنوان اولین پایه برای هر دوره آموزش طراحی سایت در نظر گرفته می‌شود.
                                                این زبان چیست و چه کاربردی دارد؟ HTML مخفف عبارت Hypertext Markup Language است.
                                            </small>
                                            <button class="btn btn-primary rounded-pill float-left mt-3 font-12" data-toggle="collapse" data-target="#download1">مشاهده لینک دانلود</button>

                                        </div>
                                    </div>
                                    <div class="mt-5 collapse" id="download1">
                                        <table class="table table-borderless text-right font-13">
                                            <tr>
                                                <td>آموزش HTML جلسه 1 - 3</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 3 - 6</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 7 - 10</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 11 - 13</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>

                                <div class="card mb-3 pb-4 shadow-sm">
                                    <div class="card-body d-md-flex">
                                        <img src="images/html-2.png" class="img-fluid float-lg-right mb-2" alt="html" width="250px" height="300px">
                                        <div class="d-inline-block pr-3 text-justify my-course">
                                            <a href="Category.html" class="mb-3 d-block text-center text-dark">آموزش HTML</a>
                                            <small>
                                                بخش اول متخصص طراحی سایت :
                                                زبان نشانه گذاری HTML به عنوان اولین پایه برای هر دوره آموزش طراحی سایت در نظر گرفته می‌شود.
                                                این زبان چیست و چه کاربردی دارد؟ HTML مخفف عبارت Hypertext Markup Language است.
                                            </small>
                                            <button class="btn btn-primary rounded-pill float-left mt-3 font-12" data-toggle="collapse" data-target="#download2">مشاهده لینک دانلود</button>

                                        </div>
                                    </div>
                                    <div class="mt-5 collapse" id="download2">
                                        <table class="table table-borderless text-right font-13">
                                            <tr>
                                                <td>آموزش HTML جلسه 1 - 3</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 3 - 6</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 7 - 10</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 11 - 13</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>


                                <div class="card mb-3 pb-4 shadow-sm">
                                    <div class="card-body d-md-flex">
                                        <img src="images/html-2.png" class="img-fluid float-lg-right mb-2" alt="html" width="250px" height="300px">
                                        <div class="d-inline-block pr-3 text-justify my-course">
                                            <a href="Category.html" class="mb-3 d-block text-center text-dark">آموزش HTML</a>
                                            <small>
                                                بخش اول متخصص طراحی سایت :
                                                زبان نشانه گذاری HTML به عنوان اولین پایه برای هر دوره آموزش طراحی سایت در نظر گرفته می‌شود.
                                                این زبان چیست و چه کاربردی دارد؟ HTML مخفف عبارت Hypertext Markup Language است.
                                            </small>
                                            <button class="btn btn-primary rounded-pill float-left mt-3 font-12" data-toggle="collapse" data-target="#download3">مشاهده لینک دانلود</button>

                                        </div>
                                    </div>
                                    <div class="mt-5 collapse" id="download3">
                                        <table class="table table-borderless text-right font-13">
                                            <tr>
                                                <td>آموزش HTML جلسه 1 - 3</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 3 - 6</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 7 - 10</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                            <tr>
                                                <td>آموزش HTML جلسه 11 - 13</td>
                                                <td><button class="btn btn-success float-left font-12"><i class="fa fa-download align-middle ml-2"></i>دانلود</button></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div><!----- End dore signup ----->


                    <div class="tab-pane fade show text-center @ViewBag.showBasket" id="shopping-cart">
                        <!----- Start shopping cart----->

                        @{
                            var courseIds = new List<int>();
                            if (httpcontextaccessor.HttpContext.Session.GetString("basket") != null)
                            {
                                courseIds = JsonConvert.DeserializeObject<List<int>>(httpcontextaccessor.HttpContext.Session.GetString("basket"));
                            }
                            var blc = new BLL.blcourse();
                            var courses = blc.serachById(courseIds);
                        }

                        <div class="card my-5 pb-4 text-center">

                            <div class="card-header">
                                <h6>سبد خرید</h6>
                            </div>

                            <div class="card-body mt-5">

                                <div class="table-responsive">
                                    <table id="myTable" class="table">
                                        <thead>
                                            <tr>
                                                <th>عکس</th>
                                                <th>نام دوره</th>
                                                <th>تعداد دوره</th>
                                                <th>قیمت دوره</th>
                                                <th>قیمت کل</th>

                                            </tr>
                                        </thead>
                                        <tbody>

                                            @foreach (var item in courses)
                                            {
                                                <tr>
                                                    <td>
                                                        <div class="product-img">
                                                            <div class="img-prdct"><img src="/images/course1/@item.picture"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <p>@item.title</p>
                                                    </td>
                                                    <td>
                                                        <div class="button-container">
                                                            <button class="cart-qty-plus" type="button" value="+">+</button>
                                                            <input type="text" name="qty" min="0" class="qty form-control" value="1" />
                                                            <button class="cart-qty-minus" type="button" value="-">-</button>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <input type="text" value="@item.price" class="price form-control" disabled>
                                                    </td>
                                                    <td> <span id="amount" class="amount">0</span>تومان</td>

                                                </tr>

                                            }

                                        </tbody>
                                    </table>

                                    <span class="font-13">قیمت کل :</span><span id="total" class="total mx-2">0</span><span class="font-13">تومان</span>

                                    <a asp-action="Peyment1" asp-controller="Payment" class="btn btn-success btn-block mt-3 font-14"> پرداخت</a>

                                </div>

                            </div>


                        </div>

                    </div><!----- End shopping cart ----->
                </div>
            </div>
        </div>
    </div>
